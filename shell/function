#!/usr/bin/env bash

# goes up the directory tree by $1 amount
up()
{
  if [[ "$#" -lt 1 ]]; then
    cd .. && return $?
  fi
  local var
  var=""
  for ((i = 0; i < $1; i++)); do
    var="../$var"
  done
  cd "$var" && return $?
}

# colorizing man-pages
man()
{
  env \
  LESS_TERMCAP_mb=$'\e[36m' \
  LESS_TERMCAP_md=$'\e[36m' \
  LESS_TERMCAP_me=$'\e[0m'  \
  LESS_TERMCAP_se=$'\e[0m'  \
  LESS_TERMCAP_so=$'\e[1m'  \
  LESS_TERMCAP_ue=$'\e[0m'  \
  LESS_TERMCAP_us=$'\e[31m' \
  man "$@"
}

# swap two files
swap()
{
  local TMPFILE=$(mktemp)
  mv "$1" "$TMPFILE"
  mv "$2" "$1"
  mv "$TMPFILE" "$2"
}

# archiving to make funny named files
archive()
{
  echo "Archiving old '$1'"
  mv --backup=numbered "$1" "$1.bak"
}

# automatic symlinking
# archive the old file if exists
soft_force_symlink()
{
  if [ ! -f "$2" ]; then
    ln -s "$1" "$2"
    return $?
  fi
  if [ -n "$(diff --brief "$2" "$1")" ]; then
    archive "$2"
  fi
  ln -sf "$1" "$2"
}

# update my dotfiles
dotfiles_update()
{
  local witness
  local rc_clone
  witness="$HOME/.zshrc"
  rc_clone="$(dirname "$(readlink -e "$witness")")"
  {
    cd "$rc_clone" &&
    git fetch &&
    git reset --hard origin/master
  }
  env zsh -l
}
